<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RAEN Guide</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Counter</li><li class="chapter-item expanded "><a href="counter/intro.html"><strong aria-hidden="true">1.</strong> Counter</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="counter/first_steps.html"><strong aria-hidden="true">1.1.</strong> Defining the data</a></li><li class="chapter-item expanded "><a href="counter/impl.html"><strong aria-hidden="true">1.2.</strong> Implementation</a></li><li class="chapter-item expanded "><a href="counter/final_code.html"><strong aria-hidden="true">1.3.</strong> Final Code</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Status Message</li><li class="chapter-item expanded "><a href="status-message/intro.html"><strong aria-hidden="true">2.</strong> Status Message</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="status-message/set_message.html"><strong aria-hidden="true">2.1.</strong> Update Account State</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">RAEN Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/raendev/guide/tree/master" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>First go install <code>raen</code>, <a href="https://raen.dev/docs/guide/installation.html">instructions here</a></p>
<p><code>raen</code> is a build tool for NEAR smart contracts.</p>
<p>Currently it has a <code>build</code> command for compiling your contract, generating it's Application Contract Interface (ACI), and injected into a custom section of a contract's WebAssembly (Wasm) binary.</p>
<p>It plans on having a <code>fetch</code> command for pulling down the ACI of deployed contracts to generate the source code bindings needed for cross contract calls and a client interface needed to interact with contracts.</p>
<p>If you have experience with NEAR and want to get to the RAEN specific stuff you can skip to the <a href="./status-message/wit.html">status message contract</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basic-counter-example"><a class="header" href="#basic-counter-example">Basic Counter Example</a></h1>
<p>At its core the NEAR blockchain is a big database.  A contract is a program with its own storage space. You have access to read and write to this storage like you would any key/value data structure.</p>
<p>The simplest example of this is a counter. A contract that can read, increment, and decrement a value.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="defining-the-data"><a class="header" href="#defining-the-data">Defining the data</a></h2>
<p>First the contract's state, what will be written to storage, needs to be defined.</p>
<pre><code class="language-rust noplayground ignore">pub struct Counter {
    val: i8,
}
</code></pre>
<h3 id="struct"><a class="header" href="#struct"><code>struct</code></a></h3>
<p>A <code>struct</code> in Rust defines a data structure with fields.  You might have seen a class or an object in JS. Unlike other languages, the data structure has no methods attached to it, rather it just defines the shape.</p>
<h3 id="val"><a class="header" href="#val"><code>val</code></a></h3>
<p>The field <code>val</code> is of type <code>i8</code>, which, while sounding a bit like a iPhone version, is a signed 8-bit integer meaning it can be between <code>-128</code> and <code>127</code>.</p>
<p>This means once <code>val</code> is incremented to <code>127</code>, the next time it will wrap around to be <code>-128</code>.</p>
<h3 id="pub"><a class="header" href="#pub"><code>pub</code></a></h3>
<p>Lastly, <code>pub</code> is short for <code>public</code>, meaning that the item is visible outside of the file<sup class="footnote-reference"><a href="#note">1</a></sup>.</p>
<div class="footnote-definition" id="note"><sup class="footnote-definition-label">1</sup>
<p>Technically it's a <a href="https://doc.rust-lang.org/reference/visibility-and-privacy.html">namespace</a>, but that's not important right now.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defining-the-implementation"><a class="header" href="#defining-the-implementation">Defining the implementation</a></h1>
<p>Rust does allow you to attach methods to the data.  This is done with an implementation (<code>impl</code>).</p>
<h2 id="a-view-method"><a class="header" href="#a-view-method">A <code>view</code> method</a></h2>
<p>Let's add a method to <code>view</code> the field <code>val</code>.</p>
<pre><code class="language-rust noplayground ignore">impl Counter {
    pub fn get_num(&amp;self) -&gt; i8 {
        self.val
    }
  ...
}
</code></pre>
<h3 id="fn"><a class="header" href="#fn"><code>fn</code></a></h3>
<p>This is the keyword for <code>function</code>. </p>
<h3 id="self"><a class="header" href="#self"><code>&amp;self</code></a></h3>
<p>This is the reference to the <code>Counter</code> struct. This lets you access the fields on the struct, however, it is <code>immutable</code> meaning that you cannot change or &quot;mutate&quot; the field.</p>
<h3 id="--i8"><a class="header" href="#--i8"><code>-&gt; i8</code></a></h3>
<p>This is the return type of the method, here an signed 8-bit integer, the same as <code>val</code>.</p>
<h3 id="selfval"><a class="header" href="#selfval"><code>self.val</code></a></h3>
<p>This accesses the field <code>val</code>.  You will also notice that there is no <code>return</code> statement, this is because in rust everything is an expression and a function returns the value of the last expression.</p>
<p>You might be familiar with <code>/** Doc Strings */</code> in other languages, Rust uses <code>///</code> vs <code>//</code> to attach the comment to document something.</p>
<h2 id="a-change-method"><a class="header" href="#a-change-method">A <code>change</code> method</a></h2>
<p>Next let's see how to mutate or change <code>val</code>. </p>
<pre><code class="language-rust noplayground ignore">impl Counter {
  ...

    pub fn increment(&amp;mut self) {
        self.val += 1;
        log!(&quot;Increased number to {}&quot;, self.val);
    }
  
  ...
}
</code></pre>
<h3 id="mut-self"><a class="header" href="#mut-self"><code>&amp;mut self</code></a></h3>
<p>Here the reference to the struct is defined as mutable, allowing it to be changed.</p>
<h3 id="selfval--1"><a class="header" href="#selfval--1"><code>self.val += 1;</code></a></h3>
<p>Here the value is incremented by 1.  This is the same as <code>self.val = self.val + 1</code>. You will also notice the semicolon, <code>;</code>; this is to separate the expressions.</p>
<h3 id="log"><a class="header" href="#log"><code>log!</code></a></h3>
<p>This is the first instance of a macro. It's not super important to understand now, but basically it is a special function that generates code.  In this case <code>log</code> generates code that formats a string and emits a log from executing the function which you can see in the NEAR explorer.</p>
<pre><code class="language-rust noplayground ignore">        log!(&quot;Increased number to {}&quot;, self.val);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="final-code"><a class="header" href="#final-code">Final Code</a></h1>
<p>Let's take a look at the full contract and go over the details skipped over first.</p>
<h2 id="imports-from-near-sdk"><a class="header" href="#imports-from-near-sdk">Imports from <code>near-sdk</code></a></h2>
<pre><code class="language-rust noplayground ignore">use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::{log, near_bindgen};
</code></pre>
<h3 id="borsh"><a class="header" href="#borsh">Borsh</a></h3>
<p>Borsh is a serialization framework, which deals with converting data into and from bytes. In the case of NEAR it is used for serializing data to be stored in the contract storage. For a type to be Borsh Serializable it needs to implement the <code>trait</code>s <code>BorshSerialize</code> and <code>BorshDeserialize</code>, which are like interfaces, with <code>serialize</code> and <code>deserialize</code> method respectively.</p>
<h3 id="log-1"><a class="header" href="#log-1">log</a></h3>
<p>We saw this before when printing the incremented value. As you can see macros are imported just like everything else.</p>
<h3 id="near_bindgen"><a class="header" href="#near_bindgen"><code>near_bindgen</code></a></h3>
<p>This is the real magic of <code>near-sdk</code>.  Like <code>log</code> it is a macro, but generates code for the whole contract.</p>
<h2 id="contract-struct"><a class="header" href="#contract-struct">Contract struct</a></h2>
<pre><code class="language-rust noplayground ignore">#[near_bindgen]
#[derive(Default, BorshDeserialize, BorshSerialize)]
pub struct Counter {
    val: i8,
}
</code></pre>
<p><code>near_bindgen</code> here means that the contract's state comes from this struct. <code>derive</code> is a built in macro. The <code>Default</code> trait has a single <code>default</code> method, which returns a default instance of a type. <code>derive(Default)</code>, generates the code of </p>
<p><code>derive(..., BorshDeserialize, BorshSerialize)</code> generates an implementation of the traits so that the contract state can be written and read to storage.</p>
<details>
<summary>Generated implementations from `derive` for those interested</summary>
<pre><code class="language-rust noplayground ignore">
impl ::core::default::Default for Counter {
    #[inline]
    fn default() -&gt; Counter {
        Counter {
            val: ::core::default::Default::default(),
        }
    }
}
impl borsh::de::BorshDeserialize for Counter
where
    i8: borsh::BorshDeserialize,
{
    fn deserialize(buf: &amp;mut &amp;[u8]) -&gt; ::core::result::Result&lt;Self, borsh::maybestd::io::Error&gt; {
        Ok(Self {
            val: borsh::BorshDeserialize::deserialize(buf)?,
        })
    }
}
impl borsh::ser::BorshSerialize for Counter
where
    i8: borsh::ser::BorshSerialize,
{
    fn serialize&lt;W: borsh::maybestd::io::Write&gt;(
        &amp;self,
        writer: &amp;mut W,
    ) -&gt; ::core::result::Result&lt;(), borsh::maybestd::io::Error&gt; {
        borsh::BorshSerialize::serialize(&amp;self.val, writer)?;
        Ok(())
    }
}

</code></pre>
</details>
<h2 id="full-implementation"><a class="header" href="#full-implementation">Full implementation</a></h2>
<pre><code class="language-rust noplayground ignore">#[near_bindgen]
impl Counter {
    /// Public method: Returns the counter value.
    pub fn get_num(&amp;self) -&gt; i8 {
        self.val
    }

    /// Public method: Increment the counter.
    pub fn increment(&amp;mut self) {
        self.val += 1;
        log!(&quot;Increased number to {}&quot;, self.val);
    }

    /// Public method: Decrement the counter.
    pub fn decrement(&amp;mut self) {
        self.val -= 1;
        log!(&quot;Decreased number to {}&quot;, self.val);
    }

    /// Public method - Reset to zero.
    pub fn reset(&amp;mut self) {
        self.val = 0;
        log!(&quot;Reset counter to zero&quot;);
    }
}
</code></pre>
<p>Looking again at the view function <code>get_num</code> it returns an <code>i8</code>, but this data must be serialized so that it can be returned to who ever called this via RPC<sup class="footnote-reference"><a href="#note">1</a></sup>. The <code>near_bindgen</code> by default generates the code to serialize this into a JSON number since this is the most common case, e.g. a web app calling <code>get_num</code>.</p>
<div class="footnote-definition" id="note"><sup class="footnote-definition-label">1</sup>
<p><a href="counter/">Remote Procedure Call</a> is the network request made to a NEAR Node to execute a view call or a change call.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basic-status-message-contract"><a class="header" href="#basic-status-message-contract">Basic Status Message Contract</a></h1>
<p>Previously the contract had state that was shared by any account that can call the contract. Next we will show how each account can get its own state within the contract.</p>
<h2 id="signer-account"><a class="header" href="#signer-account">Signer Account</a></h2>
<p>All change calls need to be signed by an account, this proves that no other account made the transaction. From the contract's perspective, when executing it has access to the current context with includes the <code>signer</code> account id.</p>
<p>Since this account id is unique to the signer it can be used as a key in storage. Let's take a look.</p>
<div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>


        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
